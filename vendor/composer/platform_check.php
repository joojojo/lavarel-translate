<?php

// platform_check.php @generated by Composer

$issues = array();

if (!(PHP_VERSION_ID >= 70300)) { // 检查PHP版本是否符合框架运行
    $issues[] = 'Your Composer dependencies require a PHP version ">= 7.3.0". You are running ' . PHP_VERSION . '.';
}

if ($issues) { // 如果存在说明
    // headers_sent() 函数检查 HTTP 标头是否已被发送以及在哪里被发送。
    if (!headers_sent()) { //这里检查http是否已经被发送,如果没有则编辑http头信息.防止多次编辑HTTP头
        header('HTTP/1.1 500 Internal Server Error');
    }
    if (!ini_get('display_errors')) { // 检查配置文件有没有设置报错等级
        if (PHP_SAPI === 'cli' || PHP_SAPI === 'phpdbg') {
            fwrite(STDERR, 'Composer detected issues in your platform:' . PHP_EOL.PHP_EOL . implode(PHP_EOL, $issues) . PHP_EOL.PHP_EOL);
        } elseif (!headers_sent()) {
            echo 'Composer detected issues in your platform:' . PHP_EOL.PHP_EOL . str_replace('You are running '.PHP_VERSION.'.', '', implode(PHP_EOL, $issues)) . PHP_EOL.PHP_EOL;
        }
    }
    // trigger_error() 函数创建用户级别的错误消息。
    trigger_error( // 出发错误
        'Composer detected issues in your platform: ' . implode(' ', $issues),
        E_USER_ERROR
    );
}
